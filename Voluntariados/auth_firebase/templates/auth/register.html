{% extends "base.html" %}

{% block title %}Registrarse{% endblock %}

{% block content %}
<div class="columns is-centered">
    <div class="column is-half">
        <div class="box-content">
            <div class="has-text-centered mb-6">
                <h1 class="title is-2 has-text-primary">
                    <i class="fas fa-user-plus mr-3"></i>Únete a Voluntariados
                </h1>
                <p class="subtitle">Crea tu cuenta y comienza a hacer la diferencia</p>
            </div>

            <form id="register-form" class="box">
                <div class="columns">
                    <div class="column">
                        <div class="field">
                            <label class="label">Nombre</label>
                            <div class="control has-icons-left">
                                <input class="input" type="text" id="first-name" placeholder="Tu nombre" required>
                                <span class="icon is-small is-left">
                                    <i class="fas fa-user"></i>
                                </span>
                            </div>
                        </div>
                    </div>
                    <div class="column">
                        <div class="field">
                            <label class="label">Apellido</label>
                            <div class="control has-icons-left">
                                <input class="input" type="text" id="last-name" placeholder="Tu apellido" required>
                                <span class="icon is-small is-left">
                                    <i class="fas fa-user"></i>
                                </span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="field">
                    <label class="label">Correo Electrónico</label>
                    <div class="control has-icons-left">
                        <input class="input" type="email" id="register-email" placeholder="tu@email.com" required>
                        <span class="icon is-small is-left">
                            <i class="fas fa-envelope"></i>
                        </span>
                    </div>
                </div>

                <div class="field">
                    <label class="label">Teléfono</label>
                    <div class="control has-icons-left">
                        <input class="input" type="tel" id="phone" placeholder="+504 9999-9999">
                        <span class="icon is-small is-left">
                            <i class="fas fa-phone"></i>
                        </span>
                    </div>
                </div>

                <div class="field">
                    <label class="label">Contraseña</label>
                    <div class="control has-icons-left">
                        <input class="input" type="password" id="register-password" placeholder="Mínimo 6 caracteres" required>
                        <span class="icon is-small is-left">
                            <i class="fas fa-lock"></i>
                        </span>
                    </div>
                    <p class="help">La contraseña debe tener al menos 6 caracteres</p>
                </div>

                <div class="field">
                    <label class="label">Confirmar Contraseña</label>
                    <div class="control has-icons-left">
                        <input class="input" type="password" id="confirm-password" placeholder="Confirma tu contraseña" required>
                        <span class="icon is-small is-left">
                            <i class="fas fa-lock"></i>
                        </span>
                    </div>
                </div>

                <div class="field">
                    <label class="label">Intereses en Voluntariado</label>
                    <div class="control">
                        <div class="select is-fullwidth">
                            <select id="volunteer-interest">
                                <option value="">Selecciona tus intereses</option>
                                <option value="medio-ambiente">Medio Ambiente</option>
                                <option value="social">Social</option>
                                <option value="animales">Animales</option>
                                <option value="educacion">Educación</option>
                                <option value="salud">Salud</option>
                                <option value="todos">Todos los anteriores</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="field">
                    <label class="checkbox">
                        <input type="checkbox" id="terms-accepted" required>
                        Acepto los <a href="#" class="has-text-primary">términos y condiciones</a> y la <a href="#" class="has-text-primary">política de privacidad</a>
                    </label>
                </div>

                <div class="field">
                    <div class="control">
                        <button class="button is-primary is-fullwidth" type="submit">
                            <span class="icon">
                                <i class="fas fa-user-plus"></i>
                            </span>
                            <span>Crear Cuenta</span>
                        </button>
                    </div>
                </div>

                <div class="has-text-centered">
                    <p>¿Ya tienes una cuenta? <a href="{% url 'auth:login' %}" class="has-text-primary">Inicia sesión aquí</a></p>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const registerForm = document.getElementById('register-form');
    
    registerForm.addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const email = document.getElementById('register-email').value;
        const password = document.getElementById('register-password').value;
        const confirmPassword = document.getElementById('confirm-password').value;
        
        // Validate passwords match
        if (password !== confirmPassword) {
            window.authManager.showMessage('Las contraseñas no coinciden.', 'error');
            return;
        }
        
        // Prepare user data
        const userData = {
            firstName: document.getElementById('first-name').value,
            lastName: document.getElementById('last-name').value,
            phone: document.getElementById('phone').value,
            volunteerInterest: document.getElementById('volunteer-interest').value,
            fullName: document.getElementById('first-name').value + ' ' + document.getElementById('last-name').value
        };
        
        try {
            await window.authManager.signUp(email, password, userData);
            // Redirect to dashboard after successful registration
            window.location.href = "{% url 'auth:dashboard' %}";
        } catch (error) {
            console.error('Registration error:', error);
        }
    });
});
</script>
{% endblock %}
