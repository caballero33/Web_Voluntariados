{% extends "base.html" %}

{% block title %}Detalles del Voluntariado{% endblock %}

{% block content %}
<div class="volunteer-details-container">
    <!-- Header Principal -->
    <div class="volunteer-header">
        <div class="container">
            <div class="header-content">
                <div class="header-left">
                    <a href="{% url 'auth:dashboard' %}" class="button is-light is-small back-button">
                        <span class="icon"><i class="fas fa-arrow-left"></i></span>
                        <span class="is-hidden-mobile">Volver al Dashboard</span>
                        <span class="is-hidden-tablet">Volver</span>
                    </a>
                </div>
                <div class="header-right">
                    <div class="volunteer-info-header">
                        <figure class="image is-64x64 volunteer-logo-container">
                            <img id="volunteer-logo" src="" alt="Logo" class="volunteer-logo">
                        </figure>
                        <div class="volunteer-details">
                            <h1 class="title is-3 has-text-white volunteer-name" id="volunteer-name">Voluntariado</h1>
                            <p class="subtitle is-6 has-text-light volunteer-category" id="volunteer-category">Categoría</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Contenido Principal -->
    <div class="main-container">
        <div class="content-wrapper">
            <!-- Columna Principal -->
            <div class="main-content">
                <!-- Navegación por Pestañas -->
                <div class="tabs-container">
                    <div class="tabs is-fullwidth">
                        <ul>
                            <li class="is-active" data-tab="wall">
                                <a>
                                    <span class="icon"><i class="fas fa-newspaper"></i></span>
                                    <span class="tab-text">Muro de Información</span>
                                </a>
                            </li>
                            <li data-tab="events">
                                <a>
                                    <span class="icon"><i class="fas fa-calendar"></i></span>
                                    <span class="tab-text">Eventos</span>
                                </a>
                            </li>
                            <li data-tab="members">
                                <a>
                                    <span class="icon"><i class="fas fa-users"></i></span>
                                    <span class="tab-text">Miembros</span>
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>

                <!-- Contenido del Muro -->
                <div id="wall-content" class="tab-content">
                    <!-- Formulario para Administradores -->
                    <div id="admin-post-form" class="admin-form-container" style="display: none;">
                        <div class="admin-form-header">
                            <h4 class="title is-5">
                                <i class="fas fa-edit mr-2"></i>Publicar en el Muro
                            </h4>
                            <span class="tag is-warning">
                                <i class="fas fa-crown mr-1"></i>Solo Administradores
                            </span>
                        </div>
                        <form id="post-form" class="admin-form">
                            <div class="field">
                                <label class="label">Título de la Publicación</label>
                                <div class="control">
                                    <input class="input" type="text" id="post-title" placeholder="Ej: Nuevo evento de limpieza" required>
                                </div>
                            </div>
                            <div class="field">
                                <label class="label">Contenido</label>
                                <div class="control">
                                    <textarea class="textarea" id="post-content" placeholder="Escribe aquí el contenido de tu publicación..." rows="4" required></textarea>
                                </div>
                            </div>
                            <div class="field is-grouped">
                                <div class="control is-expanded">
                                    <div class="select is-fullwidth">
                                        <select id="post-type">
                                            <option value="announcement">📢 Anuncio</option>
                                            <option value="event">📅 Evento</option>
                                            <option value="achievement">🏆 Logro</option>
                                            <option value="general">💬 General</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="control">
                                    <div class="select">
                                        <select id="post-priority">
                                            <option value="high">🔴 Alta</option>
                                            <option value="medium" selected>🟡 Media</option>
                                            <option value="low">🟢 Baja</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="control">
                                    <button type="submit" class="button is-primary">
                                        <span class="icon"><i class="fas fa-paper-plane"></i></span>
                                        <span>Publicar</span>
                                    </button>
                                </div>
                            </div>
                        </form>
                    </div>

                    <!-- Lista de Publicaciones -->
                    <div class="posts-container">
                        <div class="posts-header">
                            <h3 class="title is-5">
                                <i class="fas fa-newspaper mr-2"></i>Últimas Actualizaciones
                            </h3>
                        </div>
                        <div id="posts-container" class="posts-list">
                            <div class="loading-state">
                                <i class="fas fa-spinner fa-spin fa-2x"></i>
                                <p>Cargando publicaciones...</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Contenido de Eventos -->
                <div id="events-content" class="tab-content" style="display: none;">
                    <!-- Formulario para Crear Eventos (Solo Admin) -->
                    <div id="admin-event-form" class="admin-form-container" style="display: none;">
                        <div class="admin-form-header">
                            <h4 class="title is-5">
                                <i class="fas fa-plus-circle mr-2"></i>Crear Nuevo Evento
                            </h4>
                            <span class="tag is-warning">
                                <i class="fas fa-crown mr-1"></i>Solo Administradores
                            </span>
                        </div>
                        <form id="event-form" class="admin-form">
                            <div class="field">
                                <label class="label">Nombre del Evento</label>
                                <div class="control">
                                    <input class="input" type="text" id="event-title" placeholder="Ej: Limpieza del Campus" required>
                                </div>
                            </div>
                            <div class="field">
                                <label class="label">Descripción</label>
                                <div class="control">
                                    <textarea class="textarea" id="event-description" placeholder="Describe el evento..." rows="3" required></textarea>
                                </div>
                            </div>
                            <div class="field is-grouped">
                                <div class="control is-expanded">
                                    <label class="label">Fecha del Evento</label>
                                    <input class="input" type="datetime-local" id="event-date" required>
                                </div>
                                <div class="control">
                                    <label class="label">Duración (horas)</label>
                                    <div class="select">
                                        <select id="event-duration" required>
                                            <option value="1">1 hora</option>
                                            <option value="2" selected>2 horas</option>
                                            <option value="3">3 horas</option>
                                            <option value="4">4 horas</option>
                                            <option value="5">5 horas</option>
                                            <option value="6">6 horas</option>
                                            <option value="8">8 horas</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="control">
                                    <label class="label">Límite de Participantes</label>
                                    <input class="input" type="number" id="event-limit" min="1" placeholder="Ej: 20" required>
                                </div>
                                <div class="control">
                                    <label class="label">Estado</label>
                                    <div class="select">
                                        <select id="event-status">
                                            <option value="abierto">🟢 Abierto</option>
                                            <option value="cerrado">🔴 Cerrado</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="field">
                                <div class="control">
                                    <button type="submit" class="button is-primary">
                                        <span class="icon"><i class="fas fa-calendar-plus"></i></span>
                                        <span>Crear Evento</span>
                                    </button>
                                </div>
                            </div>
                        </form>
                    </div>

                    <!-- Lista de Eventos -->
                    <div class="events-container">
                        <div class="events-header">
                            <h3 class="title is-5">
                                <i class="fas fa-calendar-alt mr-2"></i>Eventos del Voluntariado
                            </h3>
                        </div>
                        <div id="events-list" class="events-list">
                            <div class="loading-state">
                                <i class="fas fa-spinner fa-spin fa-2x"></i>
                                <p>Cargando eventos...</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Contenido de Miembros -->
                <div id="members-content" class="tab-content" style="display: none;">
                    <div class="members-container">
                        <div class="members-header">
                            <h3 class="title is-5">
                                <i class="fas fa-users mr-2"></i>Miembros del Voluntariado
                            </h3>
                        </div>
                        <div id="members-container" class="members-list">
                            <div class="loading-state">
                                <i class="fas fa-spinner fa-spin fa-2x"></i>
                                <p>Cargando miembros...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Columna Lateral -->
            <div class="sidebar-content">
                    <!-- Información del Voluntariado -->
                    <div class="info-card">
                        <div class="card-header">
                            <h3 class="title is-5">
                                <i class="fas fa-info-circle mr-2"></i>Información del Voluntariado
                            </h3>
                        </div>
                        <div class="card-content">
                            <p class="description" id="volunteer-description">Descripción del voluntariado...</p>
                            <div class="stats-grid">
                                <div class="stat-item">
                                    <div class="stat-value" id="member-count">0</div>
                                    <div class="stat-label">Miembros</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-value" id="event-count">0</div>
                                    <div class="stat-label">Eventos</div>
                                </div>
                                <div class="stat-item">
                                    <span class="tag is-success" id="volunteer-status">Activo</span>
                                    <div class="stat-label">Estado</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Tu Estado -->
                    <div class="info-card">
                        <div class="card-header">
                            <h3 class="title is-5">
                                <i class="fas fa-user mr-2"></i>Tu Estado
                            </h3>
                        </div>
                        <div class="card-content">
                            <div class="user-status-grid">
                                <div class="status-item">
                                    <span class="status-label">Estado:</span>
                                    <span class="tag is-success" id="user-status">Activo</span>
                                </div>
                                <div class="status-item">
                                    <span class="status-label">Eventos Completados:</span>
                                    <span class="status-value" id="user-events">0</span>
                                </div>
                                <div class="status-item">
                                    <span class="status-label">Horas Totales:</span>
                                    <span class="status-value" id="user-hours">0</span>
                                </div>
                                <div class="status-item">
                                    <span class="status-label">Fecha de Ingreso:</span>
                                    <span class="status-value" id="join-date">-</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Administrador -->
                    <div class="info-card" id="admin-info" style="display: none;">
                        <div class="card-header">
                            <h3 class="title is-5">
                                <i class="fas fa-crown mr-2"></i>Administrador
                            </h3>
                        </div>
                        <div class="card-content">
                            <div class="admin-info">
                                <figure class="image is-48x48">
                                    <img id="admin-avatar" src="https://via.placeholder.com/48" alt="Admin" class="admin-avatar">
                                </figure>
                                <div class="admin-details">
                                    <p class="admin-name" id="admin-name">Administrador</p>
                                    <p class="admin-email" id="admin-email">admin@ejemplo.com</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
let currentVolunteerId = null;
let isAdmin = false;

document.addEventListener('DOMContentLoaded', function() {
    // Get volunteer ID from URL
    const urlParams = new URLSearchParams(window.location.search);
    currentVolunteerId = urlParams.get('id');
    
    if (!currentVolunteerId) {
        showMessage('ID de voluntariado no válido', 'danger');
        window.location.href = "{% url 'auth:dashboard' %}";
        return;
    }
    
    // Initialize page
    if (window.firebaseAuth) {
        initializePage();
    } else {
        window.addEventListener('firebaseReady', initializePage);
    }
});

async function initializePage() {
    await loadVolunteerDetails();
    await checkUserRole();
    setupTabs();
}

async function loadVolunteerDetails() {
    try {
        // Load volunteer information
        const volunteerDoc = await window.firebaseDb.collection('voluntariados').doc(currentVolunteerId).get();
        if (!volunteerDoc.exists) {
            showMessage('Voluntariado no encontrado', 'danger');
            window.location.href = "{% url 'auth:dashboard' %}";
            return;
        }
        
        const volunteer = volunteerDoc.data();
        
        // Update header
        document.getElementById('volunteer-logo').src = volunteer.logo;
        document.getElementById('volunteer-name').textContent = volunteer.name;
        document.getElementById('volunteer-category').textContent = volunteer.category;
        document.getElementById('volunteer-description').textContent = volunteer.description;
        document.getElementById('member-count').textContent = volunteer.memberCount || 0;
        document.getElementById('event-count').textContent = volunteer.eventsCount || 0;
        document.getElementById('volunteer-status').textContent = volunteer.active ? 'Activo' : 'Inactivo';
        document.getElementById('volunteer-status').className = volunteer.active ? 'tag is-success' : 'tag is-danger';
        
        // Load user status
        const user = window.firebaseAuth.currentUser;
        if (user) {
            // Cargando datos del usuario para voluntariado
            
            const userDoc = await window.firebaseDb.collection('users').doc(user.uid).get();
            
            if (userDoc.exists) {
                const userData = userDoc.data();
                // Datos del usuario cargados
                
                // Verificar si el usuario está en este voluntariado
                if (userData.voluntariados && userData.voluntariados[currentVolunteerId]) {
                    const volunteerData = userData.voluntariados[currentVolunteerId];
                    // Debug log removed
                    
                    // Verificar si el usuario está activo en este voluntariado
                    const userStatus = volunteerData.status || 'inactivo';
                    if (userStatus !== 'activo') {
                        // Debug log removed
                        // Bloquear acceso a eventos para usuarios inactivos
                        blockInactiveUserAccess();
                        return;
                    }
                    
                    // Actualizar estado
                    const statusElement = document.getElementById('user-status');
                    if (statusElement) {
                        statusElement.textContent = volunteerData.status || 'activo';
                        statusElement.className = `tag is-${(volunteerData.status || 'activo') === 'activo' ? 'success' : 'danger'}`;
                    }
                    
                    // Actualizar eventos completados
                    const eventsElement = document.getElementById('user-events');
                    if (eventsElement) {
                        eventsElement.textContent = volunteerData.eventsCompleted || 0;
                    }
                    
                    // Actualizar horas totales
                    const hoursElement = document.getElementById('user-hours');
                    if (hoursElement) {
                        hoursElement.textContent = volunteerData.totalHours || 0;
                    }
                    
                    // Actualizar fecha de ingreso
                    const joinDateElement = document.getElementById('join-date');
                    if (joinDateElement) {
                        if (volunteerData.joinedAt) {
                            const joinDate = volunteerData.joinedAt.toDate ? 
                                volunteerData.joinedAt.toDate() : 
                                new Date(volunteerData.joinedAt);
                            joinDateElement.textContent = joinDate.toLocaleDateString();
                        } else {
                            joinDateElement.textContent = '-';
                        }
                    }
                    
                                // Debug log removed
                } else {
                    // Debug log removed
                    // Si no está en el voluntariado, mostrar datos por defecto
                    document.getElementById('user-status').textContent = 'No miembro';
                    document.getElementById('user-status').className = 'tag is-warning';
                    document.getElementById('user-events').textContent = '0';
                    document.getElementById('user-hours').textContent = '0';
                    document.getElementById('join-date').textContent = '-';
                }
            } else {
                // Debug log removed
            }
        }
        
        // Load posts, events and members
        await loadPosts();
        await loadEvents();
        await loadMembers();
        
        // Configurar listener en tiempo real para cambios en los datos del usuario
        setupUserDataListener();
        
    } catch (error) {
        console.error('Error loading volunteer details:', error);
        showMessage('Error al cargar los detalles del voluntariado', 'danger');
    }
}

// Función para configurar listener en tiempo real de los datos del usuario
function setupUserDataListener() {
    const user = window.firebaseAuth.currentUser;
    if (!user || !currentVolunteerId) {
        // Debug log removed
        return;
    }
    
    // Debug log removed
    
    // Escuchar cambios en tiempo real en el documento del usuario
    window.firebaseDb.collection('users').doc(user.uid)
        .onSnapshot((doc) => {
            if (doc.exists) {
                const userData = doc.data();
                // Debug log removed
                
                // Verificar si el usuario está en este voluntariado
                if (userData.voluntariados && userData.voluntariados[currentVolunteerId]) {
                    const volunteerData = userData.voluntariados[currentVolunteerId];
                    
                    // Actualizar solo los elementos que existen
                    const statusElement = document.getElementById('user-status');
                    if (statusElement) {
                        statusElement.textContent = volunteerData.status || 'activo';
                        statusElement.className = `tag is-${(volunteerData.status || 'activo') === 'activo' ? 'success' : 'danger'}`;
                    }
                    
                    const eventsElement = document.getElementById('user-events');
                    if (eventsElement) {
                        eventsElement.textContent = volunteerData.eventsCompleted || 0;
                    }
                    
                    const hoursElement = document.getElementById('user-hours');
                    if (hoursElement) {
                        hoursElement.textContent = volunteerData.totalHours || 0;
                    }
                    
                    // Debug log removed
                }
            }
        }, (error) => {
            console.error('❌ Error en listener de datos del usuario:', error);
        });
}

// Función para actualizar manualmente los datos del usuario
async function refreshUserData() {
    // Debug log removed
    
    const user = window.firebaseAuth.currentUser;
    if (!user || !currentVolunteerId) {
        // Debug log removed
        return;
    }
    
    try {
        const userDoc = await window.firebaseDb.collection('users').doc(user.uid).get();
        
        if (userDoc.exists) {
            const userData = userDoc.data();
            
            if (userData.voluntariados && userData.voluntariados[currentVolunteerId]) {
                const volunteerData = userData.voluntariados[currentVolunteerId];
                
                // Actualizar elementos
                const statusElement = document.getElementById('user-status');
                if (statusElement) {
                    statusElement.textContent = volunteerData.status || 'activo';
                    statusElement.className = `tag is-${(volunteerData.status || 'activo') === 'activo' ? 'success' : 'danger'}`;
                }
                
                const eventsElement = document.getElementById('user-events');
                if (eventsElement) {
                    eventsElement.textContent = volunteerData.eventsCompleted || 0;
                }
                
                const hoursElement = document.getElementById('user-hours');
                if (hoursElement) {
                    hoursElement.textContent = volunteerData.totalHours || 0;
                }
                
                // Debug log removed
            }
        }
    } catch (error) {
        console.error('❌ Error actualizando datos del usuario:', error);
    }
}

// Función para bloquear acceso de usuarios inactivos
function blockInactiveUserAccess() {
    // Ocultar sección de eventos
    const eventsSection = document.getElementById('events-section');
    if (eventsSection) {
        eventsSection.innerHTML = `
            <div class="has-text-centered py-6">
                <div class="notification is-warning">
                    <h3 class="title is-4">
                        <span class="icon"><i class="fas fa-user-slash"></i></span>
                        Acceso Restringido
                    </h3>
                    <p class="subtitle is-5">Tu cuenta está inactiva en este voluntariado</p>
                    <p>Para acceder a los eventos y actividades, un administrador debe activar tu cuenta.</p>
                    <p class="mt-3">
                        <a href="/auth/dashboard/" class="button is-primary">
                            <span class="icon"><i class="fas fa-arrow-left"></i></span>
                            <span>Volver al Dashboard</span>
                        </a>
                    </p>
                </div>
            </div>
        `;
    }
    
    // Ocultar sección de miembros
    const membersSection = document.getElementById('members-section');
    if (membersSection) {
        membersSection.style.display = 'none';
    }
    
    // Ocultar sección de logros
    const achievementsSection = document.getElementById('achievements-section');
    if (achievementsSection) {
        achievementsSection.style.display = 'none';
    }
}

// Hacer la función disponible globalmente
window.refreshUserData = refreshUserData;

async function checkUserRole() {
    try {
        const user = window.firebaseAuth.currentUser;
        if (!user) {
            // Debug log removed
            window.isAdmin = false;
            return false;
        }

        if (!currentVolunteerId) {
            // Debug log removed
            window.isAdmin = false;
            return false;
        }

        // Verificar directamente en Firestore
        const volunteerDoc = await window.firebaseDb.collection('voluntariados').doc(currentVolunteerId).get();
        if (volunteerDoc.exists) {
            const adminUids = volunteerDoc.data().adminUids || [];
            window.isAdmin = adminUids.includes(user.uid);
            
            console.log('👑 Verificando permisos de admin:', {
                userUid: user.uid,
                userEmail: user.email,
                voluntariadoId: currentVolunteerId,
                adminUids: adminUids,
                isAdmin: window.isAdmin
            });
            
            // Mostrar/ocultar elementos de admin según el resultado
            const adminForm = document.getElementById('admin-post-form');
            const adminEventForm = document.getElementById('admin-event-form');
            
            if (window.isAdmin) {
                if (adminForm) {
                    adminForm.style.display = 'block';
                    // Debug log removed
                }
                if (adminEventForm) {
                    adminEventForm.style.display = 'block';
                    // Debug log removed
                }
            } else {
                if (adminForm) {
                    adminForm.style.display = 'none';
                    // Debug log removed
                }
                if (adminEventForm) {
                    adminEventForm.style.display = 'none';
                    // Debug log removed
                }
            }
            
            return window.isAdmin;
        } else {
            // Debug log removed
            window.isAdmin = false;
            return false;
        }
    } catch (error) {
        console.error('❌ Error checking user role:', error);
        window.isAdmin = false;
        return false;
    }
}

async function loadPosts() {
    // Debug log removed
    const container = document.getElementById('posts-container');
    try {
        const posts = await window.adminManager.getVolunteerPosts(currentVolunteerId);
        // Debug log removed
        // Debug log removed
        if (posts.length === 0) {
            container.innerHTML = `
                <div class="has-text-centered py-6">
                    <i class="fas fa-newspaper fa-3x has-text-grey-light"></i>
                    <p class="mt-3 has-text-grey">No hay publicaciones aún</p>
                    ${isAdmin ? '<p class="has-text-info">Como administrador, puedes publicar información importante aquí</p>' : ''}
                </div>
            `;
            return;
        }
        container.innerHTML = posts.map(post => {
            // Asegurar que el contenido esté presente
            const content = post.content || 'Sin contenido';
            const title = post.title || 'Sin título';
            const type = post.type || 'general';
            const priority = post.priority || 'medium';
            const createdAt = post.createdAt ? post.createdAt.toDate() : new Date();
            
            return `
                <div class="media post-card">
                    <div class="media-left">
                        <figure class="image is-48x48">
                            <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDgiIGhlaWdodD0iNDgiIHZpZXdCb3g9IjAgMCA0OCA0OCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMjQiIGN5PSIyNCIgcj0iMjQiIGZpbGw9IiM0YTkwZTIiLz4KPHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCwgc2Fucy1zZXJpZiIgZm9udC1zaXplPSIyNCIgZmlsbD0id2hpdGUiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGR5PSIuM2VtIj7wn5KVPC90ZXh0Pgo8L3N2Zz4K" alt="Admin" style="border-radius: 50%;">
                        </figure>
                    </div>
                    <div class="media-content">
                        <div class="content">
                            <div class="level is-mobile">
                                <div class="level-left">
                                    <div class="level-item">
                                        <div>
                                            <strong class="is-size-6">${title}</strong>
                                            <br>
                                            <small class="has-text-grey">
                                                <i class="fas fa-crown has-text-warning"></i> Administrador • 
                                                ${createdAt.toLocaleDateString()}
                                            </small>
                                        </div>
                                    </div>
                                </div>
                                <div class="level-right">
                                    <div class="level-item">
                                        <div class="tags">
                                            <span class="tag is-${getPostTypeColor(type)}">${getPostTypeIcon(type)} ${type}</span>
                                            <span class="tag is-${getPriorityColor(priority)} is-small">${getPriorityIcon(priority)}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="post-content mt-2">
                                <p>${content}</p>
                            </div>
                            ${isAdmin ? `
                                <div class="has-text-right mt-2">
                                    <button class="button is-small is-danger is-outlined" onclick="deletePost('${post.id}')">
                                        <span class="icon"><i class="fas fa-trash"></i></span>
                                        <span>Eliminar</span>
                                    </button>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                </div>
            `;
        }).join('');
    } catch (error) {
        console.error('❌ Error loading posts:', error);
        container.innerHTML = `
            <div class="has-text-centered py-6">
                <p class="has-text-danger">Error al cargar las publicaciones: ${error.message}</p>
            </div>
        `;
    }
}

async function loadEvents() {
    // Debug log removed
    const container = document.getElementById('events-list');
    
    if (!container) {
        console.error('❌ Container events-list no encontrado');
        return;
    }
    
    if (!currentVolunteerId) {
        console.error('❌ currentVolunteerId no definido');
        container.innerHTML = `
            <div class="has-text-centered py-6">
                <p class="has-text-danger">Error: ID de voluntariado no válido</p>
            </div>
        `;
        return;
    }
    
    // Debug log removed
    
    try {
        // Verificar si el usuario está activo en este voluntariado
        const user = window.firebaseAuth.currentUser;
        if (user) {
            const userDoc = await window.firebaseDb.collection('users').doc(user.uid).get();
            if (userDoc.exists) {
                const userData = userDoc.data();
                const volunteerData = userData.voluntariados?.[currentVolunteerId];
                const userStatus = volunteerData?.status || 'inactivo';
                
                if (userStatus !== 'activo') {
                    container.innerHTML = `
                        <div class="has-text-centered py-6">
                            <div class="notification is-warning">
                                <h3 class="title is-4">
                                    <span class="icon"><i class="fas fa-user-slash"></i></span>
                                    Acceso Restringido
                                </h3>
                                <p class="subtitle is-5">Tu cuenta está inactiva en este voluntariado</p>
                                <p>Para acceder a los eventos, un administrador debe activar tu cuenta.</p>
                            </div>
                        </div>
                    `;
                    return;
                }
            }
        }
        
        // Verificar permisos de admin cada vez que se cargan eventos
        await checkUserRole();
        
        // Cerrar eventos pasados automáticamente
        await window.adminManager.closePastEvents();
        
        const events = await window.adminManager.getVolunteerEvents(currentVolunteerId);
        // Debug log removed
        
        if (events.length === 0) {
            container.innerHTML = `
                <div class="has-text-centered py-6">
                    <i class="fas fa-calendar fa-3x has-text-grey-light"></i>
                    <p class="mt-3 has-text-grey">No hay eventos programados</p>
                    ${window.isAdmin ? '<p class="has-text-info">Como administrador, puedes crear eventos aquí</p>' : ''}
                </div>
            `;
            return;
        }
        
        container.innerHTML = events.map(event => {
            const eventDate = event.eventDate ? event.eventDate.toDate() : new Date();
            const now = new Date();
            const isPastEvent = eventDate < now;
            const isFull = event.currentParticipants >= event.maxParticipants;
            
            // Lógica mejorada de estados
            let eventStatus = event.status;
            let statusReason = '';
            
            if (isPastEvent) {
                eventStatus = 'cerrado';
                statusReason = 'Evento pasado';
            } else if (isFull) {
                eventStatus = 'cerrado';
                statusReason = 'Lleno';
            } else if (event.status === 'cerrado') {
                statusReason = 'Cerrado por admin';
            } else {
                eventStatus = 'abierto';
                statusReason = 'Disponible';
            }
            
            const canEnroll = eventStatus === 'abierto' && !isPastEvent && !isFull;
            const isEnrolled = event.participants && event.participants.includes(window.firebaseAuth.currentUser?.uid);
            
            return `
                <div class="event-card ${isPastEvent ? 'past-event' : ''}">
                    <div class="event-header">
                        <div class="event-title">
                            <h4 class="title is-5">${event.title}</h4>
                            <div class="event-status">
                                <span class="tag is-${eventStatus === 'abierto' ? 'success' : 'danger'}">
                                    ${eventStatus === 'abierto' ? '🟢 Abierto' : '🔴 Cerrado'}
                                </span>
                                ${isPastEvent ? '<span class="tag is-light ml-2">📅 Pasado</span>' : ''}
                                ${isFull ? '<span class="tag is-warning ml-2">👥 Lleno</span>' : ''}
                                <span class="tag is-info is-light ml-2">${statusReason}</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="event-content">
                        <p class="event-description">${event.description}</p>
                        
                        <div class="event-details">
                            <div class="event-info">
                                <span class="icon-text">
                                    <span class="icon has-text-primary">
                                        <i class="fas fa-calendar"></i>
                                    </span>
                                    <span>${eventDate.toLocaleDateString()} - ${eventDate.toLocaleTimeString()}</span>
                                </span>
                            </div>
                            
                            <div class="event-participants">
                                <span class="icon-text">
                                    <span class="icon has-text-info">
                                        <i class="fas fa-users"></i>
                                    </span>
                                    <span>${event.currentParticipants || 0}/${event.maxParticipants} participantes</span>
                                </span>
                            </div>
                        </div>
                        
                        <div class="event-actions">
                            ${!window.isAdmin ? `
                                ${canEnroll && !isEnrolled ? `
                                    <button class="button is-success is-small" onclick="enrollInEvent('${event.id}')">
                                        <span class="icon"><i class="fas fa-user-plus"></i></span>
                                        <span>Inscribirse</span>
                                    </button>
                                ` : ''}
                                
                                ${isEnrolled ? `
                                    <button class="button is-warning is-small" onclick="unenrollFromEvent('${event.id}')">
                                        <span class="icon"><i class="fas fa-user-minus"></i></span>
                                        <span>Cancelar Inscripción</span>
                                    </button>
                                ` : ''}
                                
                                ${!canEnroll && !isEnrolled ? `
                                    <button class="button is-light is-small" disabled>
                                        <span class="icon"><i class="fas fa-lock"></i></span>
                                        <span>No Disponible</span>
                                    </button>
                                ` : ''}
                            ` : `
                                <button class="button is-info is-small" onclick="viewEventDetails('${event.id}')">
                                    <span class="icon"><i class="fas fa-eye"></i></span>
                                    <span>Ver Detalles</span>
                                </button>
                                
                                <button class="button is-primary is-small" onclick="copyParticipantsList('${event.id}')">
                                    <span class="icon"><i class="fas fa-copy"></i></span>
                                    <span>Copiar Lista</span>
                                </button>
                                
                                ${!isPastEvent ? `
                                    <button class="button is-warning is-small" onclick="toggleEventStatus('${event.id}', '${eventStatus}')">
                                        <span class="icon"><i class="fas fa-toggle-${eventStatus === 'abierto' ? 'on' : 'off'}"></i></span>
                                        <span>${eventStatus === 'abierto' ? 'Cerrar' : 'Abrir'}</span>
                                    </button>
                                ` : ''}
                                
                                <button class="button is-link is-small" onclick="editEvent('${event.id}')">
                                    <span class="icon"><i class="fas fa-edit"></i></span>
                                    <span>Editar</span>
                                </button>
                                
                                <button class="button is-danger is-small" onclick="deleteEvent('${event.id}', '${event.title}')">
                                    <span class="icon"><i class="fas fa-trash"></i></span>
                                    <span>Eliminar</span>
                                </button>
                            `}
                        </div>
                    </div>
                </div>
            `;
        }).join('');
        
    } catch (error) {
        console.error('❌ Error loading events:', error);
        container.innerHTML = `
            <div class="has-text-centered py-6">
                <p class="has-text-danger">Error al cargar los eventos: ${error.message}</p>
            </div>
        `;
    }
}

async function loadMembers() {
    // Debug log removed
    const container = document.getElementById('members-container');
    
    try {
        // Primero obtenemos el voluntariado para ver quién es el admin
        const volunteerDoc = await window.firebaseDb.collection('voluntariados').doc(currentVolunteerId).get();
        const volunteerData = volunteerDoc.data();
        const adminUids = volunteerData.adminUids || [];
        
        // Debug log removed
        
        // Obtener todos los usuarios que tienen este voluntariado
        const usersSnapshot = await window.firebaseDb.collection('users').get();
        
        if (usersSnapshot.empty) {
            container.innerHTML = `
                <div class="has-text-centered py-6">
                    <i class="fas fa-users fa-3x has-text-grey-light"></i>
                    <p class="mt-3 has-text-grey">No hay miembros registrados</p>
                </div>
            `;
            return;
        }
        
        const members = [];
        
        usersSnapshot.docs.forEach(doc => {
            const user = doc.data();
            const userVolunteerData = user.voluntariados && user.voluntariados[currentVolunteerId];
            
            if (userVolunteerData) {
                const isUserAdmin = adminUids.includes(doc.id);
                members.push({
                    id: doc.id,
                    ...user,
                    isAdmin: isUserAdmin,
                    volunteerData: userVolunteerData
                });
            }
        });
        
        // Debug log removed
        
        if (members.length === 0) {
            container.innerHTML = `
                <div class="has-text-centered py-6">
                    <i class="fas fa-users fa-3x has-text-grey-light"></i>
                    <p class="mt-3 has-text-grey">No hay miembros registrados</p>
                </div>
            `;
            return;
        }
        
                    container.innerHTML = members.map(member => `
                        <div class="media member-card ${member.isAdmin ? 'admin-member' : ''}">
                            <div class="media-left">
                                <figure class="image is-48x48">
                                    <img src="data:image/svg+xml;base64,${btoa(`<svg width="48" height="48" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="24" cy="24" r="24" fill="${member.isAdmin ? '#ffd700' : '#4a90e2'}"/><text x="50%" y="50%" font-family="Arial, sans-serif" font-size="24" fill="white" text-anchor="middle" dy=".3em">${member.firstName ? member.firstName.charAt(0) : 'U'}</text></svg>`)}" alt="Avatar" style="border-radius: 50%;">
                                </figure>
                            </div>
                            <div class="media-content">
                                <div class="content">
                                    <div class="level is-mobile">
                                        <div class="level-left">
                                            <div class="level-item">
                                                <div>
                                                    <strong class="is-size-6">
                                                        ${member.isAdmin ? '<i class="fas fa-star has-text-warning mr-1"></i>' : ''}
                                                        ${member.firstName || 'Usuario'} ${member.lastName || ''}
                                                    </strong>
                                                    ${member.isAdmin ? '<span class="tag is-warning ml-2"><i class="fas fa-crown"></i> Administrador</span>' : ''}
                                                    <br>
                                                    <small class="has-text-grey">${member.email}</small>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="level-right">
                                            <div class="level-item">
                                                <span class="tag is-${member.volunteerData.status === 'activo' ? 'success' : 'danger'}">${member.volunteerData.status}</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="level is-mobile mt-2">
                                        <div class="level-item has-text-centered">
                                            <div>
                                                <p class="heading">Eventos</p>
                                                <p class="title is-6">${member.volunteerData.eventsCompleted || 0}</p>
                                            </div>
                                        </div>
                                        <div class="level-item has-text-centered">
                                            <div>
                                                <p class="heading">Horas</p>
                                                <p class="title is-6">${member.volunteerData.totalHours || 0}</p>
                                            </div>
                                        </div>
                                        <div class="level-item has-text-centered">
                                            <div>
                                                <p class="heading">Ingreso</p>
                                                <p class="title is-6 is-size-7">${member.volunteerData.joinedAt ? new Date(member.volunteerData.joinedAt.toDate()).toLocaleDateString() : '-'}</p>
                                            </div>
                                        </div>
                                    </div>
                                    ${isAdmin && !member.isAdmin ? `
                                        <div class="has-text-right mt-2">
                                            <button class="button is-small is-success is-outlined" onclick="promoteToAdmin('${member.uid}')">
                                                <span class="icon"><i class="fas fa-crown"></i></span>
                                                <span>Hacer Admin</span>
                                            </button>
                                        </div>
                                    ` : ''}
                                </div>
                            </div>
                        </div>
                    `).join('');
        
    } catch (error) {
        console.error('❌ Error loading members:', error);
        container.innerHTML = `
            <div class="has-text-centered py-6">
                <p class="has-text-danger">Error al cargar los miembros: ${error.message}</p>
            </div>
        `;
    }
}

function setupTabs() {
    const tabs = document.querySelectorAll('.tabs li');
    const contents = document.querySelectorAll('.tab-content');
    
    tabs.forEach(tab => {
        tab.addEventListener('click', async () => {
            // Remove active class from all tabs
            tabs.forEach(t => t.classList.remove('is-active'));
            contents.forEach(c => c.style.display = 'none');
            
            // Add active class to clicked tab
            tab.classList.add('is-active');
            
            // Show corresponding content
            const tabName = tab.dataset.tab;
            document.getElementById(`${tabName}-content`).style.display = 'block';
            
            // Si se cambia a la pestaña de eventos, verificar permisos de admin
            if (tabName === 'events') {
                // Debug log removed
                await checkUserRole();
                await loadEvents();
            } else if (tabName === 'wall') {
                // Debug log removed
                await checkUserRole();
                await loadPosts();
            }
        });
    });
}

// Post form handler - Solo se ejecuta si el formulario existe
document.addEventListener('DOMContentLoaded', function() {
    const postForm = document.getElementById('post-form');
    if (postForm) {
        postForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const title = document.getElementById('post-title').value;
            const content = document.getElementById('post-content').value;
            const type = document.getElementById('post-type').value;
            const priority = document.getElementById('post-priority').value;
            
            if (!title || !content) {
                alert('Por favor completa todos los campos');
                return;
            }
            
            try {
                await window.adminManager.createPost(currentVolunteerId, {
                    title,
                    content,
                    type,
                    priority
                });
                
                // Limpiar formulario
                postForm.reset();
                
                // Recargar posts
                await loadPosts();
                
                showMessage('Post publicado exitosamente', 'success');
            } catch (error) {
                console.error('Error creating post:', error);
                showMessage('Error al publicar: ' + error.message, 'danger');
            }
        });
    }
});

// Manejar formulario de eventos
document.addEventListener('DOMContentLoaded', function() {
    const eventForm = document.getElementById('event-form');
    if (eventForm) {
        eventForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const title = document.getElementById('event-title').value;
            const description = document.getElementById('event-description').value;
            const eventDate = document.getElementById('event-date').value;
            const duration = parseInt(document.getElementById('event-duration').value);
            const maxParticipants = parseInt(document.getElementById('event-limit').value);
            const status = document.getElementById('event-status').value;
            
            if (!title || !description || !eventDate || !duration || !maxParticipants) {
                alert('Por favor completa todos los campos');
                return;
            }
            
            try {
                await window.adminManager.createEvent(currentVolunteerId, {
                    title,
                    description,
                    eventDate: new Date(eventDate),
                    duration,
                    maxParticipants,
                    status
                });
                
                // Limpiar formulario
                eventForm.reset();
                
                // Recargar eventos
                await loadEvents();
                
                showMessage('Evento creado exitosamente', 'success');
            } catch (error) {
                console.error('Error creating event:', error);
                showMessage('Error al crear evento: ' + error.message, 'danger');
            }
        });
    }
});

// Función para inscribirse en un evento
async function enrollInEvent(eventId) {
    try {
        await window.adminManager.manageEventParticipants(eventId, 'add');
        showMessage('Te has inscrito al evento exitosamente', 'success');
        await loadEvents();
    } catch (error) {
        console.error('Error enrolling in event:', error);
        showMessage('Error al inscribirse: ' + error.message, 'danger');
    }
}

// Función para cancelar inscripción
async function unenrollFromEvent(eventId) {
    try {
        await window.adminManager.manageEventParticipants(eventId, 'remove');
        showMessage('Inscripción cancelada exitosamente', 'warning');
        await loadEvents();
    } catch (error) {
        console.error('Error unenrolling from event:', error);
        showMessage('Error al cancelar inscripción: ' + error.message, 'danger');
    }
}

// Función para copiar lista de participantes
async function copyParticipantsList(eventId) {
    try {
        const participants = await window.adminManager.getEventParticipantsDetailed(eventId);
        const event = await window.adminManager.getEvent(eventId);
        
        let listText = `LISTA DE PARTICIPANTES - ${event.title}\n`;
        listText += `Fecha: ${event.eventDate.toDate().toLocaleDateString()}\n`;
        listText += `Horas del evento: ${event.duration || 2}h\n`;
        listText += `Total inscritos: ${participants.length}/${event.maxParticipants}\n`;
        listText += `Asistencia confirmada: ${participants.filter(p => p.attended).length}\n\n`;
        
        listText += `DETALLE DE PARTICIPANTES:\n`;
        listText += `========================\n\n`;
        
        participants.forEach((participant, index) => {
            listText += `${index + 1}. ${participant.fullName}\n`;
            listText += `   📧 Email: ${participant.email}\n`;
            listText += `   📱 Teléfono: ${participant.phone || 'No registrado'}\n`;
            listText += `   ✅ Asistencia: ${participant.attendanceStatus}\n`;
            listText += `\n`;
        });
        
        await navigator.clipboard.writeText(listText);
        showMessage('Lista detallada de participantes copiada al portapapeles', 'success');
    } catch (error) {
        console.error('Error copying participants list:', error);
        showMessage('Error al copiar lista: ' + error.message, 'danger');
    }
}

// Función para cambiar estado del evento
async function toggleEventStatus(eventId, currentStatus) {
    const newStatus = currentStatus === 'abierto' ? 'cerrado' : 'abierto';
    
    if (!confirm(`¿Estás seguro de que quieres ${newStatus === 'abierto' ? 'abrir' : 'cerrar'} este evento?`)) {
        return;
    }
    
    try {
        await window.adminManager.updateEventStatus(eventId, newStatus);
        showMessage(`Evento ${newStatus === 'abierto' ? 'abierto' : 'cerrado'} exitosamente`, 'success');
        await loadEvents();
    } catch (error) {
        console.error('Error updating event status:', error);
        showMessage('Error al actualizar estado: ' + error.message, 'danger');
    }
}

// Función para ver detalles del evento
async function viewEventDetails(eventId) {
    try {
        const event = await window.adminManager.getEvent(eventId);
        const participants = await window.adminManager.getEventParticipants(eventId);
        const attendedCount = participants.filter(p => p.attended).length;
        
        let detailsHtml = `
            <div class="modal is-active">
                <div class="modal-background" onclick="closeModal()"></div>
                <div class="modal-card" style="width: 90%; max-width: 800px;">
                    <header class="modal-card-head">
                        <p class="modal-card-title">${event.title}</p>
                        <button class="delete" onclick="closeModal()"></button>
                    </header>
                    <section class="modal-card-body">
                        <div class="columns">
                            <div class="column is-8">
                                <p><strong>Descripción:</strong> ${event.description}</p>
                                <p><strong>Fecha:</strong> ${event.eventDate.toDate().toLocaleDateString()} - ${event.eventDate.toDate().toLocaleTimeString()}</p>
                                <p><strong>Duración:</strong> ${event.duration || 2} horas</p>
                                <p><strong>Participantes:</strong> ${participants.length}/${event.maxParticipants}</p>
                                <p><strong>Asistencia confirmada:</strong> ${attendedCount}/${participants.length}</p>
                                <p><strong>Estado:</strong> ${event.status === 'abierto' ? '🟢 Abierto' : '🔴 Cerrado'}</p>
                            </div>
                            <div class="column is-4">
                                <div class="box has-background-info-light">
                                    <h5 class="title is-6">Estadísticas</h5>
                                    <p><strong>Inscritos:</strong> ${participants.length}</p>
                                    <p><strong>Asistieron:</strong> ${attendedCount}</p>
                                    <p><strong>Por confirmar:</strong> ${participants.length - attendedCount}</p>
                                    <p><strong>Tasa asistencia:</strong> ${participants.length > 0 ? Math.round((attendedCount / participants.length) * 100) : 0}%</p>
                                </div>
                            </div>
                        </div>
                        
                        <h4 class="title is-6 mt-4">Participantes Inscritos:</h4>
                        <div class="participants-list" style="max-height: 300px; overflow-y: auto;">
        `;
        
        if (participants.length === 0) {
            detailsHtml += '<p class="has-text-grey">No hay participantes inscritos</p>';
        } else {
            participants.forEach((participant, index) => {
                const statusIcon = participant.attended ? '✅' : '⏳';
                const statusClass = participant.attended ? 'has-text-success' : 'has-text-warning';
                const buttonClass = participant.attended ? 'is-success is-static' : 'is-primary';
                const buttonText = participant.attended ? 'Asistió' : 'Marcar Asistencia';
                
                detailsHtml += `
                    <div class="participant-item box" style="margin-bottom: 0.5rem;">
                        <div class="columns is-vcentered">
                            <div class="column is-8">
                                <span class="icon-text">
                                    <span class="icon">
                                        <i class="fas fa-user"></i>
                                    </span>
                                    <span><strong>${participant.fullName}</strong></span>
                                    <span class="tag is-light ml-2">${participant.email}</span>
                                </span>
                                <br>
                                <small class="${statusClass}">${statusIcon} ${participant.attended ? 'Asistencia confirmada' : 'Pendiente de confirmar'}</small>
                            </div>
                            <div class="column is-4 has-text-right">
                                <button class="button is-small ${buttonClass}" onclick="markAttendance('${eventId}', '${participant.uid}')" ${participant.attended ? 'disabled' : ''}>
                                    <span class="icon"><i class="fas fa-${participant.attended ? 'check' : 'check'}"></i></span>
                                    <span>${buttonText}</span>
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            });
        }
        
        detailsHtml += `
                        </div>
                    </section>
                    <footer class="modal-card-foot">
                        <button class="button is-warning" onclick="showAttendanceChecklist('${eventId}')">
                            <span class="icon"><i class="fas fa-list-check"></i></span>
                            <span>Checklist de Asistencia</span>
                        </button>
                        <button class="button is-primary" onclick="copyParticipantsList('${eventId}')">
                            <span class="icon"><i class="fas fa-copy"></i></span>
                            <span>Copiar Lista</span>
                        </button>
                        <button class="button" onclick="closeModal()">Cerrar</button>
                    </footer>
                </div>
            </div>
        `;
        
        document.body.insertAdjacentHTML('beforeend', detailsHtml);
    } catch (error) {
        console.error('Error viewing event details:', error);
        showMessage('Error al cargar detalles: ' + error.message, 'danger');
    }
}

// Función para marcar asistencia
async function markAttendance(eventId, participantId) {
    try {
        await window.adminManager.markAttendance(eventId, participantId);
        showMessage('Asistencia marcada exitosamente', 'success');
        viewEventDetails(eventId); // Recargar detalles
    } catch (error) {
        console.error('Error marking attendance:', error);
        showMessage('Error al marcar asistencia: ' + error.message, 'danger');
    }
}

// Función para mostrar checklist de asistencia
async function showAttendanceChecklist(eventId) {
    try {
        const event = await window.adminManager.getEvent(eventId);
        const participants = await window.adminManager.getEventParticipantsDetailed(eventId);
        
        if (participants.length === 0) {
            showMessage('No hay participantes inscritos en este evento', 'warning');
            return;
        }
        
        // Cerrar modal anterior si existe
        closeModal();
        
        let checklistHtml = `
            <div class="modal is-active">
                <div class="modal-background" onclick="closeModal()"></div>
                <div class="modal-card" style="width: 95%; max-width: 900px;">
                    <header class="modal-card-head">
                        <p class="modal-card-title">
                            <span class="icon"><i class="fas fa-list-check"></i></span>
                            Checklist de Asistencia - ${event.title}
                        </p>
                        <button class="delete" onclick="closeModal()"></button>
                    </header>
                    <section class="modal-card-body">
                        <div class="notification is-info">
                            <strong>Instrucciones:</strong> Marca con ✅ a los participantes que asistieron al evento. 
                            Solo los marcados recibirán las ${event.duration || 2} horas del evento.
                        </div>
                        
                        <div class="field is-grouped mb-4">
                            <div class="control">
                                <button class="button is-success" onclick="selectAllParticipants()">
                                    <span class="icon"><i class="fas fa-check-double"></i></span>
                                    <span>Marcar Todos</span>
                                </button>
                            </div>
                            <div class="control">
                                <button class="button is-light" onclick="unselectAllParticipants()">
                                    <span class="icon"><i class="fas fa-times"></i></span>
                                    <span>Desmarcar Todos</span>
                                </button>
                            </div>
                            <div class="control">
                                <span class="tag is-info" id="selected-count">0 seleccionados</span>
                            </div>
                        </div>
                        
                        <div class="participants-checklist" style="max-height: 400px; overflow-y: auto;">
        `;
        
        participants.forEach((participant, index) => {
            const isChecked = participant.attended ? 'checked' : '';
            checklistHtml += `
                <div class="participant-checkbox-item box" style="margin-bottom: 0.5rem;">
                    <label class="checkbox is-flex is-align-items-center">
                        <input type="checkbox" class="participant-checkbox" 
                               value="${participant.uid}" ${isChecked}
                               onchange="updateSelectedCount()">
                        <div class="ml-3">
                            <div class="is-flex is-align-items-center">
                                <span class="icon has-text-primary mr-2">
                                    <i class="fas fa-user"></i>
                                </span>
                                <strong>${participant.fullName}</strong>
                                <span class="tag is-light ml-2">${participant.email}</span>
                                ${participant.attended ? '<span class="tag is-success ml-2">Ya confirmado</span>' : ''}
                            </div>
                            <small class="has-text-grey">
                                📱 ${participant.phone || 'Teléfono no registrado'}
                            </small>
                        </div>
                    </label>
                </div>
            `;
        });
        
        checklistHtml += `
                        </div>
                    </section>
                    <footer class="modal-card-foot">
                        <button class="button is-success" onclick="confirmAttendanceBatch('${eventId}')" id="confirm-btn" disabled>
                            <span class="icon"><i class="fas fa-check"></i></span>
                            <span>Confirmar Asistencia Seleccionada</span>
                        </button>
                        <button class="button is-primary" onclick="copyParticipantsList('${eventId}')">
                            <span class="icon"><i class="fas fa-copy"></i></span>
                            <span>Copiar Lista</span>
                        </button>
                        <button class="button" onclick="closeModal()">Cancelar</button>
                    </footer>
                </div>
            </div>
        `;
        
        document.body.insertAdjacentHTML('beforeend', checklistHtml);
        updateSelectedCount(); // Actualizar contador inicial
    } catch (error) {
        console.error('Error showing attendance checklist:', error);
        showMessage('Error al cargar checklist: ' + error.message, 'danger');
    }
}

// Función para actualizar contador de seleccionados
function updateSelectedCount() {
    const checkboxes = document.querySelectorAll('.participant-checkbox');
    const selectedCount = document.querySelectorAll('.participant-checkbox:checked').length;
    const countElement = document.getElementById('selected-count');
    const confirmBtn = document.getElementById('confirm-btn');
    
    if (countElement) {
        countElement.textContent = `${selectedCount} seleccionados`;
    }
    
    if (confirmBtn) {
        confirmBtn.disabled = selectedCount === 0;
    }
}

// Función para seleccionar todos los participantes
function selectAllParticipants() {
    const checkboxes = document.querySelectorAll('.participant-checkbox');
    checkboxes.forEach(checkbox => {
        checkbox.checked = true;
    });
    updateSelectedCount();
}

// Función para deseleccionar todos los participantes
function unselectAllParticipants() {
    const checkboxes = document.querySelectorAll('.participant-checkbox');
    checkboxes.forEach(checkbox => {
        checkbox.checked = false;
    });
    updateSelectedCount();
}

// Función para confirmar asistencia en lote
async function confirmAttendanceBatch(eventId) {
    const checkboxes = document.querySelectorAll('.participant-checkbox:checked');
    const selectedIds = Array.from(checkboxes).map(checkbox => checkbox.value);
    
    if (selectedIds.length === 0) {
        showMessage('Selecciona al menos un participante', 'warning');
        return;
    }
    
    if (!confirm(`¿Confirmar asistencia para ${selectedIds.length} participantes?\n\nEsto asignará ${selectedIds.length} × ${(await window.adminManager.getEvent(eventId)).duration || 2} horas a los participantes seleccionados.`)) {
        return;
    }
    
    try {
        const result = await window.adminManager.markAttendanceBatch(eventId, selectedIds);
        
        showMessage(`✅ Asistencia confirmada para ${result.success} participantes\n❌ Errores: ${result.errors}`, 'success');
        
        // Cerrar modal y recargar eventos
        closeModal();
        await loadEvents();
    } catch (error) {
        console.error('Error confirming batch attendance:', error);
        showMessage('Error al confirmar asistencia: ' + error.message, 'danger');
    }
}

// Función para cerrar modal
function closeModal() {
    const modal = document.querySelector('.modal.is-active');
    if (modal) {
        modal.remove();
    }
}

// Función de debug para verificar permisos de admin
window.debugAdminPermissions = async function() {
    // Debug log removed
    console.log('📊 Estado actual:', {
        currentVolunteerId: currentVolunteerId,
        windowIsAdmin: window.isAdmin,
        user: window.firebaseAuth.currentUser?.uid,
        userEmail: window.firebaseAuth.currentUser?.email
    });
    
    const result = await checkUserRole();
    // Debug log removed
    
    // Verificar elementos DOM
    const adminForm = document.getElementById('admin-post-form');
    const adminEventForm = document.getElementById('admin-event-form');
    console.log('🎛️ Elementos DOM:', {
        adminPostForm: adminForm ? adminForm.style.display : 'No encontrado',
        adminEventForm: adminEventForm ? adminEventForm.style.display : 'No encontrado'
    });
    
    return result;
};

// Función para forzar verificación de permisos
window.forceCheckAdmin = async function() {
    // Debug log removed
    await checkUserRole();
    await loadEvents();
    // Debug log removed
};

// Función para eliminar evento
async function deleteEvent(eventId, eventTitle) {
    if (!confirm(`¿Estás seguro de que quieres eliminar el evento "${eventTitle}"?\n\nEsta acción eliminará:\n- El evento\n- Todas las inscripciones\n- Los datos de asistencia\n\nEsta acción NO se puede deshacer.`)) {
        return;
    }
    
    try {
        await window.adminManager.deleteEvent(eventId);
        showMessage('Evento eliminado exitosamente', 'success');
        await loadEvents();
    } catch (error) {
        console.error('Error deleting event:', error);
        showMessage('Error al eliminar evento: ' + error.message, 'danger');
    }
}

// Función para editar evento
async function editEvent(eventId) {
    try {
        const event = await window.adminManager.getEvent(eventId);
        
        // Crear modal de edición
        const editModal = `
            <div class="modal is-active">
                <div class="modal-background" onclick="closeModal()"></div>
                <div class="modal-card">
                    <header class="modal-card-head">
                        <p class="modal-card-title">Editar Evento: ${event.title}</p>
                        <button class="delete" onclick="closeModal()"></button>
                    </header>
                    <section class="modal-card-body">
                        <form id="edit-event-form">
                            <div class="field">
                                <label class="label">Nombre del Evento</label>
                                <div class="control">
                                    <input class="input" type="text" id="edit-event-title" value="${event.title}" required>
                                </div>
                            </div>
                            <div class="field">
                                <label class="label">Descripción</label>
                                <div class="control">
                                    <textarea class="textarea" id="edit-event-description" rows="3" required>${event.description}</textarea>
                                </div>
                            </div>
                            <div class="field is-grouped">
                                <div class="control is-expanded">
                                    <label class="label">Fecha del Evento</label>
                                    <input class="input" type="datetime-local" id="edit-event-date" value="${event.eventDate.toDate().toISOString().slice(0, 16)}" required>
                                </div>
                                <div class="control">
                                    <label class="label">Duración (horas)</label>
                                    <div class="select">
                                        <select id="edit-event-duration" required>
                                            <option value="1" ${event.duration === 1 ? 'selected' : ''}>1 hora</option>
                                            <option value="2" ${event.duration === 2 ? 'selected' : ''}>2 horas</option>
                                            <option value="3" ${event.duration === 3 ? 'selected' : ''}>3 horas</option>
                                            <option value="4" ${event.duration === 4 ? 'selected' : ''}>4 horas</option>
                                            <option value="5" ${event.duration === 5 ? 'selected' : ''}>5 horas</option>
                                            <option value="6" ${event.duration === 6 ? 'selected' : ''}>6 horas</option>
                                            <option value="8" ${event.duration === 8 ? 'selected' : ''}>8 horas</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="control">
                                    <label class="label">Límite de Participantes</label>
                                    <input class="input" type="number" id="edit-event-limit" min="1" value="${event.maxParticipants}" required>
                                </div>
                                <div class="control">
                                    <label class="label">Estado</label>
                                    <div class="select">
                                        <select id="edit-event-status">
                                            <option value="abierto" ${event.status === 'abierto' ? 'selected' : ''}>🟢 Abierto</option>
                                            <option value="cerrado" ${event.status === 'cerrado' ? 'selected' : ''}>🔴 Cerrado</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </section>
                    <footer class="modal-card-foot">
                        <button class="button is-success" onclick="saveEventChanges('${eventId}')">
                            <span class="icon"><i class="fas fa-save"></i></span>
                            <span>Guardar Cambios</span>
                        </button>
                        <button class="button" onclick="closeModal()">Cancelar</button>
                    </footer>
                </div>
            </div>
        `;
        
        document.body.insertAdjacentHTML('beforeend', editModal);
    } catch (error) {
        console.error('Error loading event for edit:', error);
        showMessage('Error al cargar evento para editar: ' + error.message, 'danger');
    }
}

// Función para guardar cambios del evento
async function saveEventChanges(eventId) {
    try {
        const title = document.getElementById('edit-event-title').value;
        const description = document.getElementById('edit-event-description').value;
        const eventDate = document.getElementById('edit-event-date').value;
        const duration = parseInt(document.getElementById('edit-event-duration').value);
        const maxParticipants = parseInt(document.getElementById('edit-event-limit').value);
        const status = document.getElementById('edit-event-status').value;
        
        if (!title || !description || !eventDate || !duration || !maxParticipants) {
            alert('Por favor completa todos los campos');
            return;
        }
        
        await window.adminManager.updateEvent(eventId, {
            title,
            description,
            eventDate: new Date(eventDate),
            duration,
            maxParticipants,
            status
        });
        
        closeModal();
        showMessage('Evento actualizado exitosamente', 'success');
        await loadEvents();
    } catch (error) {
        console.error('Error updating event:', error);
        showMessage('Error al actualizar evento: ' + error.message, 'danger');
    }
}

async function deletePost(postId) {
    if (!confirm('¿Estás seguro de que quieres eliminar esta publicación?')) return;
    
    try {
        await window.firebaseDb.collection('voluntariados')
            .doc(currentVolunteerId)
            .collection('posts')
            .doc(postId)
            .delete();
        
        showMessage('Publicación eliminada exitosamente', 'success');
        await loadPosts();
        
    } catch (error) {
        console.error('Error deleting post:', error);
        showMessage('Error al eliminar la publicación', 'danger');
    }
}

function getPostTypeColor(type) {
    const colors = {
        'announcement': 'warning',
        'event': 'info',
        'achievement': 'success',
        'general': 'light'
    };
    return colors[type] || 'light';
}

function getPostTypeIcon(type) {
    const icons = {
        'announcement': '📢',
        'event': '📅',
        'achievement': '🏆',
        'general': '💬'
    };
    return icons[type] || '💬';
}

function getPostTypeLabel(type) {
    const labels = {
        'announcement': 'Anuncio',
        'event': 'Evento',
        'achievement': 'Logro',
        'general': 'General'
    };
    return labels[type] || 'General';
}

function showMessage(message, type = 'info') {
    const notification = document.createElement('div');
    notification.className = `notification is-${type} is-light`;
    notification.innerHTML = `
        <button class="delete"></button>
        ${message}
    `;
    
    document.body.appendChild(notification);
    
    setTimeout(() => {
        if (notification.parentNode) {
            notification.parentNode.removeChild(notification);
        }
    }, 5000);
    
    notification.querySelector('.delete').addEventListener('click', () => {
        if (notification.parentNode) {
            notification.parentNode.removeChild(notification);
        }
    });

}

// Funciones auxiliares para posts
function getPostTypeColor(type) {
    const colors = {
        'announcement': 'warning',
        'event': 'info',
        'achievement': 'success',
        'general': 'light'
    };
    return colors[type] || 'light';
}

function getPostTypeIcon(type) {
    const icons = {
        'announcement': '📢',
        'event': '📅',
        'achievement': '🏆',
        'general': '💬'
    };
    return icons[type] || '💬';
}

function getPriorityColor(priority) {
    const colors = {
        'high': 'danger',
        'medium': 'warning',
        'low': 'success'
    };
    return colors[priority] || 'light';
}

function getPriorityIcon(priority) {
    const icons = {
        'high': '🔴',
        'medium': '🟡',
        'low': '🟢'
    };
    return icons[priority] || '⚪';
}

// Promover usuario a administrador
async function promoteToAdmin(userId) {
    if (!confirm('¿Estás seguro de que quieres promover a este usuario a administrador?')) {
        return;
    }
    
    try {
        await window.adminManager.assignAdminRole(userId, currentVolunteerId);
        showMessage('Usuario promovido a administrador exitosamente', 'success');
        await loadMembers();
    } catch (error) {
        console.error('Error promoting user:', error);
        showMessage('Error al promover usuario: ' + error.message, 'danger');
    }
}

// Eliminar post
async function deletePost(postId) {
    if (!confirm('¿Estás seguro de que quieres eliminar este post?')) {
        return;
    }
    
    try {
        await window.firebaseDb.collection('posts').doc(postId).delete();
        showMessage('Post eliminado exitosamente', 'success');
        await loadPosts();
    } catch (error) {
        console.error('Error deleting post:', error);
        showMessage('Error al eliminar post: ' + error.message, 'danger');
    }
}

// Función para mostrar mensajes
function showMessage(message, type = 'info') {
    const notification = document.createElement('div');
    notification.className = `notification is-${type} is-light`;
    notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 1000;
        max-width: 400px;
        animation: slideInRight 0.3s ease;
    `;
    notification.innerHTML = `
        <button class="delete"></button>
        ${message}
    `;
    document.body.appendChild(notification);
    
    setTimeout(() => {
        if (notification.parentNode) {
            notification.parentNode.removeChild(notification);
        }
    }, 5000);
    
    notification.querySelector('.delete').addEventListener('click', () => {
        if (notification.parentNode) {
            notification.parentNode.removeChild(notification);
        }
    });
}
</script>

<style>
/* ===== LAYOUT PRINCIPAL ===== */
.volunteer-details-container {
    min-height: 100vh;
    background: linear-gradient(135deg, #2989d8 0%, #18559b 100%);
    padding: 0;
    overflow-x: hidden;
}

/* ===== HEADER ===== */
.volunteer-header {
    background: rgba(0, 0, 0, 0.9);
    backdrop-filter: blur(10px);
    padding: 1rem 0;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    position: sticky;
    top: 0;
    z-index: 100;
}

.header-content {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 1rem;
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 1rem;
}

.header-left {
    flex-shrink: 0;
}

.header-right {
    flex: 1;
    display: flex;
    justify-content: flex-end;
}

.volunteer-info-header {
    display: flex;
    align-items: center;
    gap: 1rem;
    max-width: 100%;
}

.volunteer-logo-container {
    flex-shrink: 0;
}

.volunteer-logo {
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.volunteer-details {
    flex: 1;
    min-width: 0;
    overflow: hidden;
}

.volunteer-name {
    margin: 0;
    font-weight: 700;
    font-size: 1.5rem;
    line-height: 1.2;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.volunteer-category {
    margin: 0;
    opacity: 0.8;
    font-size: 0.875rem;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

/* ===== CONTENIDO PRINCIPAL ===== */
.main-container {
    padding: 1.5rem 1rem;
    max-width: 1200px;
    margin: 0 auto;
}

.content-wrapper {
    display: grid;
    grid-template-columns: 2fr 1fr;
    gap: 2rem;
    align-items: start;
}

.main-content {
    min-width: 0;
}

/* ===== NAVEGACIÓN POR PESTAÑAS ===== */
.tabs-container {
    margin-bottom: 2rem;
}

.tabs.is-fullwidth {
    background: rgba(255, 255, 255, 0.1);
    border-radius: 12px;
    padding: 0.5rem;
    backdrop-filter: blur(10px);
    overflow: hidden;
}

.tabs.is-fullwidth ul {
    display: flex;
    width: 100%;
    margin: 0;
}

.tabs.is-fullwidth li {
    flex: 1;
    margin: 0;
}

.tabs.is-fullwidth li.is-active a {
    background: #2989d8;
    border-color: #2989d8;
    color: white;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(41, 137, 216, 0.3);
}

.tabs.is-fullwidth a {
    border: 1px solid transparent;
    color: rgba(255, 255, 255, 0.8);
    border-radius: 8px;
    transition: all 0.3s ease;
    padding: 0.75rem 1rem;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    text-align: center;
    min-height: 48px;
}

.tabs.is-fullwidth a:hover {
    background: rgba(255, 255, 255, 0.1);
    color: white;
    border-color: rgba(255, 255, 255, 0.2);
}

.tab-text {
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

/* ===== CONTENIDO DE PESTAÑAS ===== */
.tab-content {
    display: none;
}

.tab-content:first-child {
    display: block;
}

/* ===== FORMULARIO DE ADMINISTRADORES ===== */
.admin-form-container {
    background: linear-gradient(135deg, rgba(255, 193, 7, 0.1), rgba(255, 193, 7, 0.05));
    border: 2px solid #ffc107;
    border-radius: 12px;
    padding: 1.5rem;
    margin-bottom: 2rem;
    backdrop-filter: blur(10px);
}

.admin-form-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;
}

.admin-form-header .title {
    color: #ffc107;
    font-weight: 600;
    margin: 0;
}

.admin-form {
    background: white;
    border-radius: 8px;
    padding: 1.5rem;
}

/* ===== CONTENEDOR DE PUBLICACIONES ===== */
.posts-container {
    background: rgba(255, 255, 255, 0.95);
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
}

.posts-header {
    background: linear-gradient(135deg, #2989d8, #18559b);
    color: white;
    padding: 1rem 1.5rem;
}

.posts-header .title {
    color: white;
    margin: 0;
    font-weight: 600;
}

.posts-list {
    padding: 1.5rem;
}

/* ===== CONTENEDOR DE EVENTOS ===== */
.events-container {
    background: rgba(255, 255, 255, 0.95);
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
}

.events-header {
    background: linear-gradient(135deg, #2989d8, #18559b);
    color: white;
    padding: 1rem 1.5rem;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.events-header .title {
    color: white;
    margin: 0;
    font-weight: 600;
}

.events-list {
    padding: 1.5rem;
    max-height: 600px;
    overflow-y: auto;
}

/* ===== TARJETAS DE EVENTOS ===== */
.event-card {
    background: white;
    border-radius: 12px;
    padding: 1.5rem;
    margin-bottom: 1rem;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    border-left: 4px solid #2989d8;
}

.event-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
}

.event-card.past-event {
    opacity: 0.7;
    border-left-color: #95a5a6;
    background: #f8f9fa;
}

.event-card.past-event .event-title h4 {
    color: #6c757d;
}

.event-card.past-event .event-description {
    color: #868e96;
}

.event-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 1rem;
}

.event-title h4 {
    margin: 0;
    color: #2c3e50;
    font-weight: 600;
}

.event-status {
    display: flex;
    gap: 0.5rem;
    flex-wrap: wrap;
}

.event-content {
    margin-bottom: 1rem;
}

.event-description {
    color: #555;
    line-height: 1.6;
    margin-bottom: 1rem;
}

.event-details {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
    margin-bottom: 1rem;
}

.event-info, .event-participants {
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.event-actions {
    display: flex;
    gap: 0.5rem;
    flex-wrap: wrap;
    justify-content: flex-end;
}

/* ===== MODAL DE EVENTOS ===== */
.participants-list {
    max-height: 300px;
    overflow-y: auto;
    border: 1px solid #e9ecef;
    border-radius: 8px;
    padding: 1rem;
}

.participant-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.5rem 0;
    border-bottom: 1px solid #f1f3f4;
}

.participant-item:last-child {
    border-bottom: none;
}

/* ===== CONTENEDOR DE MIEMBROS ===== */
.members-container {
    background: rgba(255, 255, 255, 0.95);
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
}

.members-header {
    background: linear-gradient(135deg, #27ae60, #2ecc71);
    color: white;
    padding: 1rem 1.5rem;
}

.members-header .title {
    color: white;
    margin: 0;
    font-weight: 600;
}

.members-list {
    padding: 1.5rem;
}

/* ===== SIDEBAR ===== */
.sidebar-content {
    position: sticky;
    top: 2rem;
    min-width: 0;
}

.info-card {
    background: rgba(255, 255, 255, 0.95);
    border-radius: 12px;
    margin-bottom: 1.5rem;
    overflow: hidden;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    width: 100%;
}

.info-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
}

.card-header {
    background: linear-gradient(135deg, #34495e, #2c3e50);
    color: white;
    padding: 1rem 1.5rem;
}

.card-header .title {
    color: white;
    margin: 0;
    font-weight: 600;
}

.card-content {
    padding: 1.5rem;
}

/* ===== INFORMACIÓN DEL VOLUNTARIADO ===== */
.description {
    color: #666;
    line-height: 1.6;
    margin-bottom: 1.5rem;
}

.stats-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 1rem;
}

.stat-item {
    text-align: center;
    padding: 1rem;
    background: #f8f9fa;
    border-radius: 8px;
    border: 1px solid #e9ecef;
}

.stat-value {
    font-size: 1.5rem;
    font-weight: 700;
    color: #2989d8;
    display: block;
}

.stat-label {
    font-size: 0.875rem;
    color: #666;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-top: 0.25rem;
}

/* ===== ESTADO DEL USUARIO ===== */
.user-status-grid {
    display: flex;
    flex-direction: column;
    gap: 1rem;
}

.status-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.75rem;
    background: #f8f9fa;
    border-radius: 8px;
    border-left: 4px solid #2989d8;
}

.status-label {
    font-weight: 500;
    color: #555;
}

.status-value {
    font-weight: 600;
    color: #333;
}

/* ===== INFORMACIÓN DEL ADMINISTRADOR ===== */
.admin-info {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1rem;
    background: linear-gradient(135deg, #ffc107, #ff9800);
    border-radius: 8px;
    color: white;
}

.admin-avatar {
    border-radius: 50%;
    border: 3px solid white;
}

.admin-details {
    flex: 1;
}

.admin-name {
    font-weight: 600;
    margin: 0;
    color: white;
}

.admin-email {
    font-size: 0.875rem;
    margin: 0;
    opacity: 0.9;
}

/* ===== ESTADOS DE CARGA ===== */
.loading-state {
    text-align: center;
    padding: 3rem;
    color: #666;
}

.loading-state i {
    color: #3498db;
    margin-bottom: 1rem;
}

/* ===== TARJETAS DE MIEMBROS ===== */
.member-card {
    background: white;
    border: 1px solid #e9ecef;
    border-radius: 8px;
    padding: 1rem;
    margin-bottom: 1rem;
    transition: all 0.3s ease;
}

.member-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    border-color: #3498db;
}

.member-card:last-child {
    margin-bottom: 0;
}

/* ===== ESTILOS PARA ADMINISTRADORES ===== */
.admin-member {
    border-left: 4px solid #ffd700 !important;
    background: linear-gradient(135deg, #fff9e6 0%, #ffffff 100%);
}

.admin-member .member-card {
    border-left: 4px solid #ffd700;
}

.admin-member .media-left img {
    border: 2px solid #ffd700 !important;
}

.post-card {
    background: white;
    border-radius: 12px;
    padding: 1rem;
    margin-bottom: 1rem;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.post-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
}

.post-card .media-left img {
    border: 2px solid #4a90e2;
}

/* ===== CONTENIDO DE POSTS ===== */
.post-content {
    background: #f8f9fa;
    border-left: 4px solid #3498db;
    padding: 1rem;
    border-radius: 0 8px 8px 0;
    margin: 1rem 0;
}

.post-content p {
    margin: 0;
    line-height: 1.6;
    color: #333;
    font-size: 0.95rem;
}

.post-card {
    border-left: 4px solid #3498db;
    transition: all 0.3s ease;
}

.post-card:hover {
    border-left-color: #2980b9;
    transform: translateX(4px);
}

/* ===== TARJETAS DE POSTS ===== */
.posts-container {
    background: rgba(255, 255, 255, 0.95);
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
}

.posts-header {
    background: linear-gradient(135deg, #667eea, #764ba2);
    color: white;
    padding: 1rem 1.5rem;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.posts-list {
    padding: 1.5rem;
    max-height: 600px;
    overflow-y: auto;
}

/* ===== FORMULARIO DE ADMINISTRADOR ===== */
.admin-form-container {
    background: rgba(255, 255, 255, 0.95);
    border-radius: 12px;
    margin-bottom: 2rem;
    overflow: hidden;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
}

.admin-form-header {
    background: linear-gradient(135deg, #ffd700, #ffed4e);
    color: #333;
    padding: 1rem 1.5rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.admin-form {
    padding: 1.5rem;
}

.admin-form .field {
    margin-bottom: 1rem;
}

.admin-form .label {
    font-weight: 600;
    color: #333;
}

.admin-form .input,
.admin-form .textarea,
.admin-form .select select {
    border-radius: 8px;
    border: 1px solid #ddd;
    transition: border-color 0.3s ease, box-shadow 0.3s ease;
}

.admin-form .input:focus,
.admin-form .textarea:focus,
.admin-form .select select:focus {
    border-color: #3498db;
    box-shadow: 0 0 0 0.125em rgba(52, 152, 219, 0.25);
}

/* ===== RESPONSIVE ===== */

/* Tablets y pantallas medianas */
@media (max-width: 1024px) {
    .content-wrapper {
        grid-template-columns: 1fr;
        gap: 1.5rem;
    }
    
    .sidebar-content {
        position: static;
        order: -1;
    }
    
    .main-container {
        padding: 1rem;
    }
}

/* Móviles grandes */
@media (max-width: 768px) {
    .volunteer-header {
        padding: 0.75rem 0;
    }
    
    .header-content {
        padding: 0 0.75rem;
        gap: 0.75rem;
    }
    
    .volunteer-info-header {
        flex-direction: column;
        text-align: center;
        gap: 0.5rem;
    }
    
    .volunteer-logo-container {
        align-self: center;
    }
    
    .volunteer-name {
        font-size: 1.25rem;
        white-space: normal;
        text-align: center;
    }
    
    .volunteer-category {
        white-space: normal;
        text-align: center;
    }
    
    .main-container {
        padding: 0.75rem;
    }
    
    .tabs-container {
        margin-bottom: 1rem;
    }
    
    .tabs.is-fullwidth a {
        padding: 0.5rem 0.75rem;
        min-height: 44px;
        font-size: 0.875rem;
    }
    
    .tab-text {
        display: none;
    }
    
    .tabs.is-fullwidth a .icon {
        font-size: 1.125rem;
    }
    
    .stats-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 0.75rem;
    }
    
    .user-status-grid {
        gap: 0.75rem;
    }
    
    .status-item {
        flex-direction: column;
        align-items: flex-start;
        gap: 0.25rem;
        padding: 0.5rem;
    }
    
    .admin-form-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 0.5rem;
    }
}

/* Móviles pequeños */
@media (max-width: 480px) {
    .header-content {
        padding: 0 0.5rem;
        gap: 0.5rem;
    }
    
    .volunteer-logo-container .image {
        width: 48px;
        height: 48px;
    }
    
    .volunteer-name {
        font-size: 1.125rem;
    }
    
    .volunteer-category {
        font-size: 0.75rem;
    }
    
    .main-container {
        padding: 0.5rem;
    }
    
    .tabs.is-fullwidth {
        padding: 0.25rem;
    }
    
    .tabs.is-fullwidth a {
        padding: 0.5rem;
        min-height: 40px;
        font-size: 0.75rem;
    }
    
    .tabs.is-fullwidth a .icon {
        font-size: 1rem;
    }
    
    .stats-grid {
        grid-template-columns: 1fr;
        gap: 0.5rem;
    }
    
    .stat-item {
        padding: 0.75rem;
    }
    
    .stat-value {
        font-size: 1.25rem;
    }
    
    .admin-form-container {
        padding: 1rem;
        margin-bottom: 1rem;
    }
    
    .admin-form {
        padding: 1rem;
    }
    
    .posts-container,
    .members-container {
        margin: 0;
    }
    
    .posts-header,
    .members-header {
        padding: 0.75rem 1rem;
    }
    
    .posts-list,
    .members-list {
        padding: 1rem;
    }
    
    .card-header {
        padding: 0.75rem 1rem;
    }
    
    .card-content {
        padding: 1rem;
    }
    
    .info-card {
        margin-bottom: 1rem;
    }
}

/* Pantallas muy pequeñas */
@media (max-width: 360px) {
    .header-content {
        flex-direction: column;
        gap: 0.5rem;
        text-align: center;
    }
    
    .header-left,
    .header-right {
        width: 100%;
        justify-content: center;
    }
    
    .volunteer-info-header {
        justify-content: center;
    }
    
    .tabs.is-fullwidth a {
        padding: 0.375rem;
        min-height: 36px;
        font-size: 0.7rem;
    }
    
    .tabs.is-fullwidth a .icon {
        font-size: 0.875rem;
    }
}

/* ===== ANIMACIONES ===== */
@keyframes fadeIn {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.tab-content {
    animation: fadeIn 0.3s ease;
}

.info-card {
    animation: fadeIn 0.5s ease;
}

/* ===== MEJORAS DE ACCESIBILIDAD ===== */
.button:focus,
.input:focus,
.textarea:focus,
.select select:focus {
    box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.3);
    outline: none;
}

/* ===== UTILIDADES ===== */
.has-text-primary {
    color: #3498db !important;
}

.has-text-light {
    color: rgba(255, 255, 255, 0.8) !important;
}

.has-text-white {
    color: white !important;
}
</style>
{% endblock %}
